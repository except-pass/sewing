---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/db.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/db.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">mranderson.sandbox</span> <span class="kn">import</span> <span class="n">start_neo4j</span><span class="p">,</span> <span class="n">start_fresh</span><span class="p">,</span> <span class="n">create_totem</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">container_name</span> <span class="o">=</span> <span class="s1">&#39;sewing_test_db&#39;</span>
<span class="n">container</span><span class="p">,</span> <span class="n">driver</span> <span class="o">=</span> <span class="n">start_neo4j</span><span class="p">(</span><span class="n">container_name</span><span class="o">=</span><span class="n">container_name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ensure_unique_nodes" class="doc_header"><code>ensure_unique_nodes</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ensure_unique_nodes</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">start_fresh</span><span class="p">())</span>
<span class="n">create_totem</span><span class="p">()</span>
<span class="n">ensure_unique_nodes</span><span class="p">()</span>
<span class="n">ensure_unique_nodes</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_29628/1176448886.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> TESTCASE <span class="ansi-blue-fg">=</span> unittest<span class="ansi-blue-fg">.</span>TestCase<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>TESTCASE<span class="ansi-blue-fg">.</span>assertTrue<span class="ansi-blue-fg">(</span>start_fresh<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> create_totem<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> ensure_unique_nodes<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> ensure_unique_nodes<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;start_fresh&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="guild_node" class="doc_header"><code>guild_node</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L24" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>guild_node</code>(<strong><code>guild</code></strong>, <strong><code>variable_name</code></strong>=<em><code>'guild'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="user_node" class="doc_header"><code>user_node</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L28" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>user_node</code>(<strong><code>user</code></strong>, <strong><code>variable_name</code></strong>=<em><code>'user'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="channel_node" class="doc_header"><code>channel_node</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L34" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>channel_node</code>(<strong><code>channel</code></strong>, <strong><code>variable_name</code></strong>=<em><code>'channel'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FakeGuild</span><span class="p">:</span>
    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;abc123&#39;</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fake&#39;</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FakeUser</span><span class="p">:</span>
    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;user789&#39;</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;user#789&#39;</span>
    <span class="n">discriminator</span><span class="o">=</span><span class="s1">&#39;789&#39;</span>
    
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FakeChannel</span><span class="p">:</span>
    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;89123&#39;</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fakechannel&#39;</span>
    
<span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">guild_node</span><span class="p">(</span><span class="n">FakeGuild</span><span class="p">()),</span> <span class="s1">&#39;(guild:Guild {id: &quot;abc123&quot;})&#39;</span><span class="p">)</span>
<span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">user_node</span><span class="p">(</span><span class="n">FakeUser</span><span class="p">()),</span> <span class="s1">&#39;(user:User {id: &quot;user789&quot;,name: &quot;user#789&quot;,discriminator: &quot;789&quot;})&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ensure_guild" class="doc_header"><code>ensure_guild</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L39" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ensure_guild</code>(<strong><code>guild</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="guilds" class="doc_header"><code>guilds</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L45" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>guilds</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_ensure_guild</span><span class="p">():</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">start_fresh</span><span class="p">())</span>
    <span class="n">create_totem</span><span class="p">()</span>
    <span class="n">fg</span> <span class="o">=</span> <span class="n">FakeGuild</span><span class="p">()</span>
    <span class="n">ensure_guild</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>
    <span class="n">ensure_guild</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>    
    <span class="n">ensure_guild</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>
    
    <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">()</span>
    <span class="n">q</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;MATCH&quot;</span><span class="p">)</span>
    <span class="n">q</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">guild_node</span><span class="p">(</span><span class="n">fg</span><span class="p">))</span>
    <span class="n">q</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;RETURN count(guild) as num&#39;</span><span class="p">)</span>    
    <span class="n">resp</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">single</span><span class="p">()</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">)</span>
<span class="n">test_ensure_guild</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SUCCESS
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="register_user" class="doc_header"><code>register_user</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>register_user</code>(<strong><code>user</code></strong>, <strong><code>guild</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="unregister_user" class="doc_header"><code>unregister_user</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L68" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>unregister_user</code>(<strong><code>user</code></strong>, <strong><code>guild</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="set_email" class="doc_header"><code>set_email</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L80" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>set_email</code>(<strong><code>user</code></strong>, <strong><code>email</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_email" class="doc_header"><code>get_email</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L89" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_email</code>(<strong><code>user</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_guild_emails" class="doc_header"><code>get_guild_emails</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L97" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_guild_emails</code>(<strong><code>guild</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="seeall" class="doc_header"><code>seeall</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L109" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>seeall</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_register</span><span class="p">():</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">start_fresh</span><span class="p">())</span>
    <span class="n">create_totem</span><span class="p">()</span>
    
    <span class="n">user</span> <span class="o">=</span> <span class="n">FakeUser</span><span class="p">()</span>
    
    <span class="n">ensure_guild</span><span class="p">(</span><span class="n">FakeGuild</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">seeall</span><span class="p">())</span>
    
    <span class="n">resp</span> <span class="o">=</span> <span class="n">register_user</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">FakeGuild</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">seeall</span><span class="p">())</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">relationships_created</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">nodes_created</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">get_email</span><span class="p">(</span><span class="n">user</span><span class="p">)[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span>
    <span class="c1">#run it again</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">register_user</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">FakeGuild</span><span class="p">())</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">relationships_created</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">nodes_created</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">properties_set</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="n">set_email</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="s1">&#39;adifferent@email.com&#39;</span><span class="p">)</span>

    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;user789&#39;</span><span class="p">)[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="s1">&#39;adifferent@email.com&#39;</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">unregister_user</span><span class="p">(</span><span class="n">FakeUser</span><span class="p">(),</span> <span class="n">FakeGuild</span><span class="p">())</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">relationships_deleted</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_email</span><span class="p">(</span><span class="n">user</span><span class="p">)[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="s1">&#39;adifferent@email.com&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">)</span>
<span class="n">test_register</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[{&#39;n&#39;: {&#39;eid&#39;: &#39;totem&#39;, &#39;is_test_data&#39;: True}}, {&#39;n&#39;: {&#39;name&#39;: &#39;fake&#39;, &#39;id&#39;: &#39;abc123&#39;}}]
[{&#39;n&#39;: {&#39;eid&#39;: &#39;totem&#39;, &#39;is_test_data&#39;: True}}, {&#39;n&#39;: {&#39;name&#39;: &#39;fake&#39;, &#39;id&#39;: &#39;abc123&#39;}}, {&#39;n&#39;: {&#39;name&#39;: &#39;user#789&#39;, &#39;id&#39;: &#39;user789&#39;, &#39;discriminator&#39;: &#39;789&#39;}}]
SUCCESS
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_unregister</span><span class="p">():</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">start_fresh</span><span class="p">())</span>
    <span class="n">create_totem</span><span class="p">()</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">unregister_user</span><span class="p">(</span><span class="n">FakeUser</span><span class="p">(),</span> <span class="n">FakeGuild</span><span class="p">())</span>    
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">relationships_deleted</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">)</span>
<span class="n">test_unregister</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SUCCESS
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_channel" class="doc_header"><code>add_channel</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L118" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_channel</code>(<strong><code>channel</code></strong>, <strong><code>guild</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_channel" class="doc_header"><code>remove_channel</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L131" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_channel</code>(<strong><code>channel</code></strong>, <strong><code>guild</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="summarized_channels" class="doc_header"><code>summarized_channels</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L140" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>summarized_channels</code>(<strong><code>guild</code></strong>, <strong><code>names_only</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_add_channel</span><span class="p">():</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">start_fresh</span><span class="p">())</span>
    <span class="n">create_totem</span><span class="p">()</span>
    
    <span class="n">resp</span> <span class="o">=</span> <span class="n">add_channel</span><span class="p">(</span><span class="n">FakeChannel</span><span class="p">(),</span> <span class="n">FakeGuild</span><span class="p">())</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">relationships_created</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">nodes_created</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1">#run it again</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">add_channel</span><span class="p">(</span><span class="n">FakeChannel</span><span class="p">(),</span> <span class="n">FakeGuild</span><span class="p">())</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">relationships_created</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">nodes_created</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">properties_set</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;Channel&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;89123&#39;</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="s1">&#39;fakechannel&#39;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">summarized_channels</span><span class="p">(</span><span class="n">FakeGuild</span><span class="p">(),</span> <span class="n">names_only</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    
    <span class="n">resp</span> <span class="o">=</span> <span class="n">remove_channel</span><span class="p">(</span><span class="n">FakeChannel</span><span class="p">(),</span> <span class="n">FakeGuild</span><span class="p">())</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">nodes_deleted</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">relationships_deleted</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">)</span>
<span class="n">test_add_channel</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[{&#39;channel&#39;: {&#39;name&#39;: &#39;fakechannel&#39;, &#39;id&#39;: &#39;89123&#39;}}]
SUCCESS
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_suggestion" class="doc_header"><code>add_suggestion</code><a href="https://github.com/except-pass/sewing/tree/master/sewing/db.py#L154" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_suggestion</code>(<strong><code>user</code></strong>, <strong>*<code>args</code></strong>, <strong><code>ts</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_add_suggestion</span><span class="p">():</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">start_fresh</span><span class="p">())</span>
    <span class="n">create_totem</span><span class="p">()</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">add_suggestion</span><span class="p">(</span><span class="n">FakeUser</span><span class="p">(),</span> <span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="s1">&#39;good&#39;</span><span class="p">)</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">nodes_created</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">add_suggestion</span><span class="p">(</span><span class="n">FakeUser</span><span class="p">(),</span> <span class="s1">&#39;make it better&#39;</span><span class="p">)</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">nodes_created</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">()</span>
    <span class="n">q</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;MATCH (s:Suggestion) return count(s) as num&quot;</span><span class="p">)</span>
    <span class="n">TESTCASE</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">only</span><span class="p">()[</span><span class="s1">&#39;num&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_add_suggestion</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">notebook2script</span><span class="p">(</span><span class="n">_nbpath</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted db.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

